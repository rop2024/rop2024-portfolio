{% extends 'base.html' %}
{% load static %}
{% load custom_filters %}

{% block title %}Statistics - Portfolio{% endblock %}
{% block description %}Portfolio statistics and analytics{% endblock %}

{% block extra_css %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    .stat-card {
        @apply backdrop-blur-md bg-white/40 border border-white/20 rounded-xl p-8 text-center hover:bg-white/50 transition-all duration-300;
    }
    .stat-emoji {
        @apply text-4xl mb-3;
    }
    .stat-number {
        @apply text-5xl font-bold text-primary-600 mb-2;
    }
    .stat-label {
        @apply text-neutral-600 font-medium text-sm;
    }
    .chart-container {
        @apply backdrop-blur-md bg-white/40 border border-white/20 rounded-xl p-8;
        position: relative;
        height: 320px;
    }
    .chart-title {
        @apply text-lg font-semibold text-neutral-800 mb-6 absolute top-8 left-8;
    }
</style>
{% endblock %}

{% block content %}
<div class="min-h-screen pt-12 pb-16">
    <div class="container-custom max-w-6xl">
        <!-- Header -->
        <div class="text-center mb-16 animate-fade-in">
            <h1 class="text-5xl md:text-6xl font-bold text-neutral-800 mb-4">
                Statistics & Analytics
            </h1>
            <p class="text-lg text-neutral-600">
                A quick overview of my portfolio metrics
            </p>
        </div>

        <!-- Quick Stats - Minimal Card Layout -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-16 animate-fade-in-up">
            <!-- Projects Completed -->
            <div class="stat-card group">
                <div class="stat-emoji">üß±</div>
                <div class="stat-number">{{ total_projects }}</div>
                <div class="stat-label">Projects Completed</div>
            </div>

            <!-- Renders Uploaded -->
            <div class="stat-card group">
                <div class="stat-emoji">üé®</div>
                <div class="stat-number">{{ total_renders }}</div>
                <div class="stat-label">Renders Uploaded</div>
            </div>

            <!-- Featured Projects -->
            <div class="stat-card group">
                <div class="stat-emoji">‚≠ê</div>
                <div class="stat-number">{{ featured_projects_count }}</div>
                <div class="stat-label">Featured Projects</div>
            </div>

            <!-- Messages -->
            <div class="stat-card group">
                <div class="stat-emoji">üí¨</div>
                <div class="stat-number">{{ total_contact_messages }}</div>
                <div class="stat-label">Messages Received</div>
            </div>
        </div>

        <!-- Charts Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8 animate-fade-in-up">
            <!-- Projects per Month (Bar Chart) -->
            <div class="chart-container">
                <h3 class="chart-title">Projects per Month</h3>
                <canvas id="monthlyProjectsChart" style="position: absolute; top: 60px; left: 0; right: 0; bottom: 0; width: 100% !important; height: calc(100% - 60px) !important;"></canvas>
            </div>

            <!-- Renders Over Time (Line Chart) -->
            <div class="chart-container">
                <h3 class="chart-title">Renders Over Time</h3>
                <canvas id="messageTrendsChart" style="position: absolute; top: 60px; left: 0; right: 0; bottom: 0; width: 100% !important; height: calc(100% - 60px) !important;"></canvas>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Clean color palette
    const colors = {
        primary: '#0ea5e9',
        success: '#10b981',
        warning: '#f59e0b',
        error: '#ef4444'
    };

    // Data from Django backend
    const chartData = {
        monthlyStats: {{ monthly_project_stats|to_json|safe }},
        messageTrends: {{ message_trends|to_json|safe }}
    };

    // Chart.js default options
    Chart.defaults.font.family = "'Inter', 'Segoe UI', sans-serif";
    Chart.defaults.color = '#6b7280';

    // Projects per Month (Bar Chart)
    try {
        const monthlyCtx = document.getElementById('monthlyProjectsChart');
        if (monthlyCtx && chartData.monthlyStats.labels && chartData.monthlyStats.labels.length > 0) {
            new Chart(monthlyCtx, {
                type: 'bar',
                data: {
                    labels: chartData.monthlyStats.labels,
                    datasets: [{
                        label: 'Projects',
                        data: chartData.monthlyStats.data,
                        backgroundColor: colors.primary,
                        borderColor: colors.primary,
                        borderWidth: 0,
                        borderRadius: 6,
                        borderSkipped: false,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'x',
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 12,
                            titleFont: { size: 14, weight: 'bold' },
                            bodyFont: { size: 13 },
                            borderColor: colors.primary,
                            borderWidth: 1,
                            displayColors: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1,
                                color: '#9ca3af',
                                font: { size: 12 }
                            },
                            grid: {
                                color: 'rgba(243, 244, 246, 0.5)',
                                drawBorder: false
                            }
                        },
                        x: {
                            ticks: {
                                color: '#9ca3af',
                                font: { size: 12 }
                            },
                            grid: {
                                display: false,
                                drawBorder: false
                            }
                        }
                    }
                }
            });
        }
    } catch (e) {
        console.error('Error with monthly chart:', e);
    }

    // Renders Over Time (Line Chart)
    try {
        const trendsCtx = document.getElementById('messageTrendsChart');
        if (trendsCtx && chartData.messageTrends.labels && chartData.messageTrends.labels.length > 0) {
            new Chart(trendsCtx, {
                type: 'line',
                data: {
                    labels: chartData.messageTrends.labels,
                    datasets: [{
                        label: 'Messages',
                        data: chartData.messageTrends.data,
                        borderColor: colors.success,
                        backgroundColor: colors.success + '20',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: colors.success,
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 5,
                        pointHoverRadius: 7,
                        pointHoverBackgroundColor: colors.success
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 12,
                            titleFont: { size: 14, weight: 'bold' },
                            bodyFont: { size: 13 },
                            borderColor: colors.success,
                            borderWidth: 1,
                            displayColors: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1,
                                color: '#9ca3af',
                                font: { size: 12 }
                            },
                            grid: {
                                color: 'rgba(243, 244, 246, 0.5)',
                                drawBorder: false
                            }
                        },
                        x: {
                            ticks: {
                                color: '#9ca3af',
                                font: { size: 12 }
                            },
                            grid: {
                                display: false,
                                drawBorder: false
                            }
                        }
                    }
                }
            });
        }
    } catch (e) {
        console.error('Error with trends chart:', e);
    }
</script>
{% endblock %}